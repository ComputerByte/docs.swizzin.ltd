(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{129:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return o})),n.d(t,"default",(function(){return p}));var a=n(3),i=n(7),r=(n(0),n(158)),l={id:"structure",title:"The project's structure",sidebar_label:"Structure"},c={unversionedId:"dev/structure",id:"dev/structure",isDocsHomePage:!1,title:"The project's structure",description:"This sub-chapter goes over what each of the folders in swizzin contains, why the contents are structured the way they are, and what the general philosophy behind the mechanisms that use them is.",source:"@site/docs/dev/structure.md",slug:"/dev/structure",permalink:"/dev/structure",editUrl:"https://github.com/liaralabs/docs.swizzin.ltd/edit/master/docs/dev/structure.md",version:"current",sidebar_label:"Structure",sidebar:"docs",previous:{title:"Getting a developer setup",permalink:"/dev/setup"},next:{title:"Functions to streamline our flow",permalink:"/dev/functions"}},o=[{value:"Scripts",id:"scripts",children:[{value:"Install",id:"install",children:[]},{value:"Remove",id:"remove",children:[]},{value:"Nginx",id:"nginx",children:[]},{value:"Upgrade",id:"upgrade",children:[]},{value:"Update",id:"update",children:[]}]},{value:"Sources",id:"sources",children:[{value:"<code>globals.sh</code>",id:"globalssh",children:[]},{value:"Functions",id:"functions",children:[]}]}],s={toc:o};function p(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This sub-chapter goes over what each of the folders in swizzin contains, why the contents are structured the way they are, and what the general philosophy behind the mechanisms that use them is."),Object(r.b)("h2",{id:"scripts"},"Scripts"),Object(r.b)("p",null,"These scripts are to be called directly from their respective ",Object(r.b)("inlineCode",{parentName:"p"},"box")," calls. Each category is expected to follow the same general structure."),Object(r.b)("h3",{id:"install"},"Install"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"scripts/install/")),Object(r.b)("p",null,"This directory contains the script that will be executed when ",Object(r.b)("inlineCode",{parentName:"p"},"box install <app>")," is executed, which will directly invoke ",Object(r.b)("inlineCode",{parentName:"p"},"scripts/install/<app>.sh"),"."),Object(r.b)("p",null,"The script should generally do the following, if it applies."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Gathering information from the user required for installation"),Object(r.b)("li",{parentName:"ul"},"Checking incompatibilities",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"Possibly migrate from previous major versions/forks of the same application, such as Sonarr v2 -> v3."))),Object(r.b)("li",{parentName:"ul"},"Installing dependencies"),Object(r.b)("li",{parentName:"ul"},"Installing the application (through ",Object(r.b)("inlineCode",{parentName:"li"},"apt"),", a binary or a script)"),Object(r.b)("li",{parentName:"ul"},"Handling user addition in case the app is Multi-user compatible."),Object(r.b)("li",{parentName:"ul"},"Creating and starting the ",Object(r.b)("inlineCode",{parentName:"li"},"systemd")," service"),Object(r.b)("li",{parentName:"ul"},"Installing an nginx config for the application",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"Note: Please make sure to print the application's port to the user when nginx is not installed!")))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Creating the lock for the application"))),Object(r.b)("h3",{id:"remove"},"Remove"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"scripts/remove/"),"\nThis directory contains the script that will be executed when ",Object(r.b)("inlineCode",{parentName:"p"},"box remove <app>")," is executed, which will directly invoke ",Object(r.b)("inlineCode",{parentName:"p"},"scripts/remove/<app>.sh")),Object(r.b)("p",null,"The script should generally do the following, if it applies."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Remove application from package managers"),Object(r.b)("li",{parentName:"ul"},"Stop and remove the service"),Object(r.b)("li",{parentName:"ul"},"Remove application files (e.g. from ",Object(r.b)("inlineCode",{parentName:"li"},"/opt"),")"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Removing the lock for the application"))),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Please note"),": Removing the application's user data/config is something we are currently debating and assessing on a per-application basis. "),Object(r.b)("h3",{id:"nginx"},"Nginx"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"scripts/nginx/")),Object(r.b)("p",null,"This directory holds scripts that enable an application to work with the ",Object(r.b)("inlineCode",{parentName:"p"},"nginx")," reverse proxy."),Object(r.b)("p",null,"There are two times this can be triggered, so please take that into account when writing these scripts"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"When nginx is already installed and an application is being installed via ",Object(r.b)("inlineCode",{parentName:"li"},"box install app")),Object(r.b)("li",{parentName:"ul"},"After an application is already installed and ",Object(r.b)("inlineCode",{parentName:"li"},"nginx")," is being via ",Object(r.b)("inlineCode",{parentName:"li"},"box install nginx"))),Object(r.b)("p",null,"This means that all changes to an app's configuration which is require for the reverse proxy to function, needs to be in here, and not in the installer."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Handle the nginx reload outside of these scripts"),". If you add nginx reloads, this would mean that while the ",Object(r.b)("inlineCode",{parentName:"p"},"nginx")," installer is running, it will have to reload after every config is installed, which is a bit unnecessary."),Object(r.b)("h3",{id:"upgrade"},"Upgrade"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"scripts/upgrade/")),Object(r.b)("p",null,"This directory contains the script that will be executed when ",Object(r.b)("inlineCode",{parentName:"p"},"box upgrade <app>")," is executed, which will directly invoke ",Object(r.b)("inlineCode",{parentName:"p"},"scripts/upgrade/<app>.sh")),Object(r.b)("p",null,"The aim of the scripts in here is to ensure that applications get upgraded across versions when one of the following scenarios is true"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Application is ",Object(r.b)("strong",{parentName:"li"},"not")," managed through the ",Object(r.b)("inlineCode",{parentName:"li"},"apt")," package manager",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"e.g. ",Object(r.b)("inlineCode",{parentName:"li"},"lounge")," is installed via ",Object(r.b)("inlineCode",{parentName:"li"},"npm")))),Object(r.b)("li",{parentName:"ul"},"There is not built in updater in the application",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"e.g. ",Object(r.b)("inlineCode",{parentName:"li"},"lounge"),' has no "update" button in the application itself'),Object(r.b)("li",{parentName:"ul"},"however ",Object(r.b)("inlineCode",{parentName:"li"},"radarr")," has a built-in self-updater, so no ",Object(r.b)("inlineCode",{parentName:"li"},"upgrade")," script is necessary"))),Object(r.b)("li",{parentName:"ul"},"A new major version needs to be opted-in by the user",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"e.g. the Sonarr v2 to Sonarr v3 migration has to be made by user's choice, and the change requires a different apt package too")))),Object(r.b)("p",null,"Before any of the upgrade scripts are ran, the ",Object(r.b)("inlineCode",{parentName:"p"},"box update")," procedure is done."),Object(r.b)("h3",{id:"update"},"Update"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"scripts/update/")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"All scripts in this directory will be executed in alphabetical order when ",Object(r.b)("inlineCode",{parentName:"strong"},"box update")," is ran"),". "),Object(r.b)("p",null,"These scripts are meant to ensure that older installations behave the exact same way that a fresh installation would. They do not upgrade packages themselves at all. They are purely maintenance scripts ran to update the installation."),Object(r.b)("p",null,"These scripts can contain non-application-specific maintenance changes as well."),Object(r.b)("h2",{id:"sources"},"Sources"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"sources")),Object(r.b)("p",null,"This directory contains a lot of helper scripts in general."),Object(r.b)("p",null,"You can read what each of these functions does in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/dev/functions"}),"functions chapter")),Object(r.b)("h3",{id:"globalssh"},Object(r.b)("inlineCode",{parentName:"h3"},"globals.sh")),Object(r.b)("p",null,"Contains everything that is taken for granted in all the scripts above."),Object(r.b)("p",null,"This script gets ran as the first thing when ",Object(r.b)("inlineCode",{parentName:"p"},"box")," functions are triggered, and when running the ",Object(r.b)("inlineCode",{parentName:"p"},"setup.sh")),Object(r.b)("p",null,"These scripts need to have all of their functions and variables ",Object(r.b)("inlineCode",{parentName:"p"},"export"),"ed so that they are accessible everywhere without them needing to be ",Object(r.b)("inlineCode",{parentName:"p"},"source"),"d in."),Object(r.b)("h3",{id:"functions"},"Functions"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"sources/functions")),Object(r.b)("p",null,"This directory contains all reusable helper functions."),Object(r.b)("p",null,"These can be organized by applications, or by specific purposes."),Object(r.b)("p",null,"Please make sure to create adequate documentation about the parameters, outputs and return codes."))}p.isMDXComponent=!0},158:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return h}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),p=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=p(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),b=p(n),d=a,h=b["".concat(l,".").concat(d)]||b[d]||u[d]||r;return n?i.a.createElement(h,c(c({ref:t},s),{},{components:n})):i.a.createElement(h,c({ref:t},s))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=d;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=e,c.mdxType="string"==typeof e?e:a,l[1]=c;for(var s=2;s<r;s++)l[s]=n[s];return i.a.createElement.apply(null,l)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);